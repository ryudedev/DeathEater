# nestjs
FROM node:22.9.0

RUN apt-get update && apt-get install -y postgresql-client

# Create app directory
WORKDIR /api

# Install app dependencies
RUN npm i -g npm@latest && npm i -g pnpm@latest && npm i -g @nestjs/cli@latest && npm i -g prisma@latest
COPY package*.json ./
RUN pnpm install
COPY setup.sh setup.sh
RUN chmod +x setup.sh

# change user
USER node

# Bundle app source
COPY --chown=node:node . .

# Expose port
EXPOSE 3000

# Start the app
CMD ["sh", "setup.sh"]
